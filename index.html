<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Evaluaci√≥n Estudiantil</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .navigation {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-button {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            min-width: 120px;
        }

        .nav-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .nav-button.active {
            background: linear-gradient(135deg, #00b894, #00a085);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .level-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            border-radius: 15px;
        }

        .level-title {
            font-size: 2em;
            color: #2d3436;
            font-weight: bold;
        }

        .manage-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-manage {
            background: linear-gradient(135deg, #fd79a8, #e84393);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-manage:hover {
            transform: translateY(-2px);
        }

        .grade-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .grade-card {
            background: linear-gradient(135deg, #ffffff, #f1f2f6);
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .grade-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            border-color: #0984e3;
        }

        .grade-title {
            font-size: 1.4em;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 15px;
            text-align: center;
        }

        .student-count {
            text-align: center;
            color: #636e72;
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .grade-actions {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .btn-small {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: #74b9ff;
            color: white;
        }

        .btn-evaluate {
            background: #00b894;
            color: white;
        }

        .btn-delete {
            background: #e17055;
            color: white;
        }

        .evaluation-form {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-top: 20px;
            display: none;
            position: relative;
        }

        .evaluation-form.active {
            display: block;
        }

        .form-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            border-radius: 10px;
        }

        .competencies {
            display: grid;
            gap: 25px;
            margin-bottom: 30px;
        }

        .competency {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .competency-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .competency-title {
            font-weight: bold;
            color: #2d3436;
            font-size: 1.1em;
            flex: 1;
        }

        .competency-actions {
            display: flex;
            gap: 5px;
        }

        .student-scores {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
        }

        .student-score {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background: #f1f2f6;
            border-radius: 8px;
        }

        .student-name {
            font-size: 0.9em;
            font-weight: bold;
            color: #2d3436;
            text-align: center;
        }

        .score-input {
            width: 60px;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: center;
            font-size: 16px;
            font-weight: bold;
        }

        .score-input:focus {
            outline: none;
            border-color: #0984e3;
            box-shadow: 0 0 10px rgba(9, 132, 227, 0.3);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #fd79a8, #e84393);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f2f6;
        }

        .modal-title {
            font-size: 1.5em;
            color: #2d3436;
            font-weight: bold;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2d3436;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .form-input:focus {
            outline: none;
            border-color: #0984e3;
        }

        .students-list {
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
        }

        .student-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin-bottom: 5px;
            background: #f1f2f6;
            border-radius: 6px;
        }

        .history-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
        }

        .history-item {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #0984e3;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .history-title {
            font-weight: bold;
            color: #2d3436;
            font-size: 1.2em;
        }

        .history-date {
            color: #636e72;
            font-size: 0.9em;
        }

        .competency-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .competency-item {
            background: #f1f2f6;
            padding: 15px;
            border-radius: 10px;
        }

        .competency-name {
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 8px;
            color: #2d3436;
        }

        .average-score {
            color: #0984e3;
            font-weight: bold;
            font-size: 1.1em;
        }

        .close-modal {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }

        .close-modal:hover {
            color: #000;
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 15px;
            }
            
            .navigation {
                flex-direction: column;
                align-items: center;
            }
            
            .level-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .grade-grid {
                grid-template-columns: 1fr;
            }
            
            .student-scores {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }

            .action-buttons {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Sistema de Evaluaci√≥n Estudiantil</h1>
            <p class="subtitle">Gesti√≥n completa de competencias y seguimiento acad√©mico</p>
        </header>

        <div class="main-content">
            <div class="navigation">
                <button class="nav-button active" onclick="showSection('home')">üè† Inicio</button>
                <button class="nav-button" onclick="showSection('primary')">üìö Primaria</button>
                <button class="nav-button" onclick="showSection('secondary')">üéì Secundaria</button>
                <button class="nav-button" onclick="showSection('competencies')">‚≠ê Competencias</button>
                <button class="nav-button" onclick="showSection('history')">üìä Historial</button>
            </div>

            <!-- Secci√≥n de Inicio -->
            <div id="home" class="section active">
                <div style="text-align: center; padding: 50px 20px;">
                    <h2 style="color: #2d3436; margin-bottom: 20px;">Bienvenido al Sistema de Evaluaci√≥n</h2>
                    <p style="color: #636e72; font-size: 1.2em; margin-bottom: 30px;">
                        Gestiona estudiantes, competencias y realiza evaluaciones de manera sencilla
                    </p>
                    <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="showSection('primary')">üìö Ir a Primaria</button>
                        <button class="btn btn-secondary" onclick="showSection('secondary')">üéì Ir a Secundaria</button>
                        <button class="btn btn-danger" onclick="showSection('competencies')">‚≠ê Gestionar Competencias</button>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n de Primaria -->
            <div id="primary" class="section">
                <div class="level-header">
                    <div class="level-title">üìö Educaci√≥n Primaria</div>
                    <div class="manage-buttons">
                        <button class="btn-manage" onclick="addGrade('primary')">+ A√±adir Grado</button>
                    </div>
                </div>
                <div class="grade-grid" id="primaryGrades"></div>
            </div>

            <!-- Secci√≥n de Secundaria -->
            <div id="secondary" class="section">
                <div class="level-header">
                    <div class="level-title">üéì Educaci√≥n Secundaria</div>
                    <div class="manage-buttons">
                        <button class="btn-manage" onclick="addGrade('secondary')">+ A√±adir Grado</button>
                    </div>
                </div>
                <div class="grade-grid" id="secondaryGrades"></div>
            </div>

            <!-- Secci√≥n de Competencias -->
            <div id="competencies" class="section">
                <div class="level-header">
                    <div class="level-title">‚≠ê Gesti√≥n de Competencias</div>
                    <div class="manage-buttons">
                        <button class="btn-manage" onclick="addCompetency()">+ A√±adir Competencia</button>
                    </div>
                </div>
                <div id="competenciesList"></div>
            </div>

            <!-- Secci√≥n de Historial -->
            <div id="history" class="section">
                <div class="level-header">
                    <div class="level-title">üìä Historial de Evaluaciones</div>
                    <div class="manage-buttons">
                        <button class="btn-manage" onclick="clearAllHistory()">üóëÔ∏è Limpiar Todo</button>
                    </div>
                </div>
                <div class="history-section">
                    <div id="historyList"></div>
                </div>
            </div>

            <!-- Formulario de Evaluaci√≥n -->
            <div id="evaluationForm" class="evaluation-form">
                <button class="btn btn-secondary" onclick="goBack()" style="margin-bottom: 20px;">‚Üê Volver</button>
                <div class="form-header">
                    <h3 id="formTitle">Evaluaci√≥n de Competencias</h3>
                    <p id="formSubtitle"></p>
                </div>
                <div class="competencies" id="competenciesContainer"></div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="saveEvaluation()">üíæ Guardar Evaluaci√≥n</button>
                    <button class="btn btn-secondary" onclick="addCompetencyToEvaluation()">+ A√±adir Competencia</button>
                    <button class="btn btn-danger" onclick="clearForm()">üóëÔ∏è Limpiar Formulario</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Gestionar Grados -->
    <div id="gradeModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('gradeModal')">&times;</span>
            <div class="modal-header">
                <h3 class="modal-title" id="gradeModalTitle">Gestionar Grado</h3>
            </div>
            <form id="gradeForm">
                <div class="form-group">
                    <label class="form-label">Nombre del Grado:</label>
                    <input type="text" id="gradeName" class="form-input" placeholder="Ej: 1¬∞ Primaria">
                </div>
                <div class="form-group">
                    <label class="form-label">Estudiantes:</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="text" id="studentName" class="form-input" placeholder="Nombre del estudiante" style="flex: 1;">
                        <button type="button" class="btn btn-primary" onclick="addStudent()" style="min-width: auto; padding: 10px 15px;">+</button>
                    </div>
                    <div id="studentsList" class="students-list"></div>
                </div>
                <div class="action-buttons">
                    <button type="button" class="btn btn-primary" onclick="saveGrade()">Guardar</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('gradeModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Gestionar Competencias -->
    <div id="competencyModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('competencyModal')">&times;</span>
            <div class="modal-header">
                <h3 class="modal-title">A√±adir Competencia</h3>
            </div>
            <div class="form-group">
                <label class="form-label">Nombre de la Competencia:</label>
                <input type="text" id="competencyName" class="form-input" placeholder="Ingresa el nombre de la competencia">
            </div>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="saveCompetency()">Guardar</button>
                <button class="btn btn-secondary" onclick="closeModal('competencyModal')">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let grades = JSON.parse(localStorage.getItem('grades') || JSON.stringify({
            primary: [
                { id: 'p1', name: '1¬∞ Primaria', students: ['Ana Garc√≠a', 'Luis Mart√≠n', 'Mar√≠a L√≥pez', 'Carlos Silva', 'Elena Ruiz'] },
                { id: 'p2', name: '2¬∞ Primaria', students: ['Pedro S√°nchez', 'Laura Torres', 'Diego Mendoza', 'Sofia Herrera'] },
                { id: 'p3', name: '3¬∞ Primaria', students: ['Javier Cruz', 'Valeria Castillo', 'Miguel Ortega', 'Isabella Morales'] },
                { id: 'p4', name: '4¬∞ Primaria', students: ['Fernando Vega', 'Camila Jim√©nez', 'Andr√©s Ramos', 'Natalia Guerrero'] },
                { id: 'p5', name: '5¬∞ Primaria', students: ['Ricardo Flores', 'Gabriela Pe√±a', 'Sebasti√°n Molina', 'Daniela Castro'] },
                { id: 'p6', name: '6¬∞ Primaria', students: ['Alejandro Vargas', 'Valentina Rojas', 'Nicol√°s Aguilar', 'Mariana Delgado'] }
            ],
            secondary: [
                { id: 's1', name: '1¬∞ Secundaria', students: ['Arturo Medina', 'Ximena N√∫√±ez', 'Emilio Paredes', 'Renata Salinas'] },
                { id: 's2', name: '2¬∞ Secundaria', students: ['Mateo Fuentes', 'Sof√≠a Campos', 'Joaqu√≠n Rivera', 'Antonia Espinoza'] },
                { id: 's3', name: '3¬∞ Secundaria', students: ['Bruno Contreras', 'Constanza Bravo', 'Tom√°s Soto', 'Francisca Le√≥n'] },
                { id: 's4', name: '4¬∞ Secundaria', students: ['Ignacio Mu√±oz', 'Isidora Ponce', 'Maximiliano C√°rdenas', 'Amparo Tapia'] },
                { id: 's5', name: '5¬∞ Secundaria', students: ['Rodrigo Ib√°√±ez', 'Esperanza Moreno', 'Esteban Reyes'] }
            ]
        }));

        let competencies = JSON.parse(localStorage.getItem('competencies') || JSON.stringify([
            'PRODUCTO',
            'MANEJO DE PROGRAMAS PARA ELABORAR UN PROYECTO',
            'TRABAJA EN EQUIPO CON RESPONSABILIDAD',
            'MECANOGRAF√çA',
            'REALIZA PROYECTOS DE LO COMPLEJO A LO SIMPLE'
        ]));

        let evaluationHistory = JSON.parse(localStorage.getItem('evaluationHistory') || '[]');
        let currentGrade = null;
        let currentSection = 'home';
        let currentLevel = null;
        let editingGrade = null;
        let tempStudents = [];

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            renderGrades();
            renderCompetencies();
            renderHistory();
            saveData();
        });

        // Navegaci√≥n
        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
            document.getElementById('evaluationForm').classList.remove('active');
            
            document.getElementById(section).classList.add('active');
            event.target.classList.add('active');
            currentSection = section;
        }

        // Gesti√≥n de Grados
        function renderGrades() {
            renderGradeSection('primaryGrades', grades.primary);
            renderGradeSection('secondaryGrades', grades.secondary);
        }

        function renderGradeSection(containerId, gradeList) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            gradeList.forEach(grade => {
                const gradeCard = document.createElement('div');
                gradeCard.className = 'grade-card';
                
                gradeCard.innerHTML = `
                    <div class="grade-title">${grade.name}</div>
                    <div class="student-count">${grade.students.length} estudiantes</div>
                    <div class="grade-actions">
                        <button class="btn-small btn-edit" onclick="editGrade('${grade.id}')">‚úèÔ∏è Editar</button>
                        <button class="btn-small btn-evaluate" onclick="openEvaluation('${grade.id}')">üìù Evaluar</button>
                        <button class="btn-small btn-delete" onclick="deleteGrade('${grade.id}')">üóëÔ∏è</button>
                    </div>
                `;
                
                container.appendChild(gradeCard);
            });
        }

        function addGrade(level) {
            currentLevel = level;
            editingGrade = null;
            tempStudents = [];
            document.getElementById('gradeModalTitle').textContent = 'A√±adir Nuevo Grado';
            document.getElementById('gradeName').value = '';
            renderTempStudents();
            openModal('gradeModal');
        }

        function editGrade(gradeId) {
            const grade = findGradeById(gradeId);
            if (!grade) return;
            
            currentLevel = gradeId.startsWith('p') ? 'primary' : 'secondary';
            editingGrade = grade;
            tempStudents = [...grade.students];
            
            document.getElementById('gradeModalTitle').textContent = 'Editar Grado';
            document.getElementById('gradeName').value = grade.name;
            renderTempStudents();
            openModal('gradeModal');
        }

        function deleteGrade(gradeId) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este grado? Se perder√°n todas las evaluaciones asociadas.')) {
                const level = gradeId.startsWith('p') ? 'primary' : 'secondary';
                grades[level] = grades[level].filter(g => g.id !== gradeId);
                
                // Eliminar evaluaciones asociadas
                evaluationHistory = evaluationHistory.filter(eval => eval.grade.id !== gradeId);
                
                renderGrades();
                renderHistory();
                saveData();
            }
        }

        function addStudent() {
            const studentName = document.getElementById('studentName').value.trim();
            if (studentName && !tempStudents.includes(studentName)) {
                tempStudents.push(studentName);
                document.getElementById('studentName').value = '';
                renderTempStudents();
            }
        }

        function removeStudent(index) {
            tempStudents.splice(index, 1);
            renderTempStudents();
        }

        function renderTempStudents() {
            const container = document.getElementById('studentsList');
            container.innerHTML = '';
            
            tempStudents.forEach((student, index) => {
                const studentItem = document.createElement('div');
                studentItem.className = 'student-item';
                studentItem.innerHTML = `
                    <span>${student}</span>
                    <button type="button" class="btn-small btn-delete" onclick="removeStudent(${index})">üóëÔ∏è</button>
                `;
                container.appendChild(studentItem);
            });
        }

        function saveGrade() {
            const gradeName = document.getElementById('gradeName').value.trim();
            if (!gradeName) {
                alert('Por favor ingresa el nombre del grado');
                return;
            }
            
            if (tempStudents.length === 0) {
                alert('Por favor a√±ade al menos un estudiante');
                return;
            }
            
            if (editingGrade) {
                // Editar grado existente
                editingGrade.name = gradeName;
                editingGrade.students = [...tempStudents];
            } else {
                // Crear nuevo grado
                const newId = currentLevel === 'primary' ? 
                    'p' + (grades.primary.length + 1) : 
                    's' + (grades.secondary.length + 1);
                
                const newGrade = {
                    id: newId,
                    name: gradeName,
                    students: [...tempStudents]
                };
                
                grades[currentLevel].push(newGrade);
            }
            
            renderGrades();
            saveData();
            closeModal('gradeModal');
        }

        // Gesti√≥n de Competencias
        function renderCompetencies() {
            const container = document.getElementById('competenciesList');
            container.innerHTML = '';
            
            competencies.forEach((competency, index) => {
                const competencyCard = document.createElement('div');
                competencyCard.className = 'competency';
                competencyCard.innerHTML = `
                    <div class="competency-header">
                        <div class="competency-actions">
                            <button class="btn-small btn-delete" onclick="deleteCompetency(${index})">üóëÔ∏è Eliminar</button>
                        </div>
                    </div>
                `;
                container.appendChild(competencyCard);
            });
        }

        function addCompetency() {
            document.getElementById('competencyName').value = '';
            openModal('competencyModal');
        }

        function saveCompetency() {
            const competencyName = document.getElementById('competencyName').value.trim();
            if (!competencyName) {
                alert('Por favor ingresa el nombre de la competencia');
                return;
            }
            
            if (!competencies.includes(competencyName)) {
                competencies.push(competencyName);
                renderCompetencies();
                saveData();
                closeModal('competencyModal');
            } else {
                alert('Esta competencia ya existe');
            }
        }

        function deleteCompetency(index) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar esta competencia?')) {
                competencies.splice(index, 1);
                renderCompetencies();
                saveData();
            }
        }

        // Gesti√≥n de Evaluaciones
        function openEvaluation(gradeId) {
            const grade = findGradeById(gradeId);
            if (!grade) return;
            
            currentGrade = grade;
            
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('evaluationForm').classList.add('active');
            
            document.getElementById('formTitle').textContent = `Evaluaci√≥n - ${grade.name}`;
            document.getElementById('formSubtitle').textContent = `${grade.students.length} estudiantes`;
            
            renderEvaluationForm(grade);
        }

        function renderEvaluationForm(grade) {
            const container = document.getElementById('competenciesContainer');
            container.innerHTML = '';
            
            competencies.forEach((competency, compIndex) => {
                const competencyDiv = document.createElement('div');
                competencyDiv.className = 'competency';
                
                const studentsHtml = grade.students.map((student, studentIndex) => `
                    <div class="student-score">
                        <div class="student-name">${student}</div>
                        <input type="number" class="score-input" 
                               min="0" max="20" 
                               data-student="${studentIndex}" 
                               data-competency="${compIndex}"
                               placeholder="0-20">
                    </div>
                `).join('');
                
                competencyDiv.innerHTML = `
                    <div class="competency-header">
                        <div class="competency-title">${competency}</div>
                        <div class="competency-actions">
                            <button class="btn-small btn-delete" onclick="removeCompetencyFromEvaluation(${compIndex})">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="student-scores">
                        ${studentsHtml}
                    </div>
                `;
                
                container.appendChild(competencyDiv);
            });
        }

        function addCompetencyToEvaluation() {
            const availableCompetencies = competencies.filter(comp => {
                const existingTitles = Array.from(document.querySelectorAll('.competency-title')).map(el => el.textContent);
                return !existingTitles.includes(comp);
            });
            
            if (availableCompetencies.length === 0) {
                alert('Todas las competencias ya est√°n incluidas en la evaluaci√≥n');
                return;
            }
            
            const selectedCompetency = prompt(`Selecciona una competencia:\n${availableCompetencies.map((comp, i) => `${i + 1}. ${comp}`).join('\n')}`);
            const index = parseInt(selectedCompetency) - 1;
            
            if (index >= 0 && index < availableCompetencies.length) {
                const competency = availableCompetencies[index];
                const container = document.getElementById('competenciesContainer');
                const compIndex = competencies.indexOf(competency);
                
                const competencyDiv = document.createElement('div');
                competencyDiv.className = 'competency';
                
                const studentsHtml = currentGrade.students.map((student, studentIndex) => `
                    <div class="student-score">
                        <div class="student-name">${student}</div>
                        <input type="number" class="score-input" 
                               min="0" max="20" 
                               data-student="${studentIndex}" 
                               data-competency="${compIndex}"
                               placeholder="0-20">
                    </div>
                `).join('');
                
                competencyDiv.innerHTML = `
                    <div class="competency-header">
                        <div class="competency-title">${competency}</div>
                        <div class="competency-actions">
                            <button class="btn-small btn-delete" onclick="removeCompetencyFromEvaluation(${compIndex})">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="student-scores">
                        ${studentsHtml}
                    </div>
                `;
                
                container.appendChild(competencyDiv);
            }
        }

        function removeCompetencyFromEvaluation(compIndex) {
            if (confirm('¬øRemover esta competencia de la evaluaci√≥n actual?')) {
                const competencyElements = document.querySelectorAll('.competency');
                competencyElements.forEach(element => {
                    const title = element.querySelector('.competency-title').textContent;
                    if (title === competencies[compIndex]) {
                        element.remove();
                    }
                });
            }
        }

        function saveEvaluation() {
            if (!currentGrade) return;
            
            const evaluation = {
                id: Date.now(),
                date: new Date().toLocaleString('es-ES'),
                grade: currentGrade,
                competencies: {}
            };
            
            const competencyElements = document.querySelectorAll('.competency');
            competencyElements.forEach(element => {
                const competencyTitle = element.querySelector('.competency-title').textContent;
                evaluation.competencies[competencyTitle] = {};
                
                const inputs = element.querySelectorAll('.score-input');
                inputs.forEach(input => {
                    const studentIndex = input.dataset.student;
                    const studentName = currentGrade.students[studentIndex];
                    const score = parseFloat(input.value) || 0;
                    evaluation.competencies[competencyTitle][studentName] = score;
                });
            });
            
            evaluationHistory.unshift(evaluation);
            saveData();
            
            alert('Evaluaci√≥n guardada exitosamente');
            renderHistory();
        }

        function clearForm() {
            if (confirm('¬øEst√°s seguro de que quieres limpiar el formulario?')) {
                document.querySelectorAll('.score-input').forEach(input => {
                    input.value = '';
                });
            }
        }

        function goBack() {
            document.getElementById('evaluationForm').classList.remove('active');
            document.getElementById(currentSection).classList.add('active');
        }

        // Gesti√≥n del Historial
        function renderHistory() {
            const container = document.getElementById('historyList');
            
            if (evaluationHistory.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #636e72; padding: 40px;">No hay evaluaciones guardadas a√∫n.</p>';
                return;
            }
            
            container.innerHTML = '';
            
            evaluationHistory.forEach(evaluation => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                const competencySummary = Object.keys(evaluation.competencies).map(comp => {
                    const scores = Object.values(evaluation.competencies[comp]);
                    const average = scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;
                    return `
                        <div class="competency-item">
                            <div class="competency-name">${comp}</div>
                            <div class="average-score">Promedio: ${average.toFixed(1)}</div>
                        </div>
                    `;
                }).join('');
                
                historyItem.innerHTML = `
                    <div class="history-header">
                        <div class="history-title">${evaluation.grade.name}</div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="history-date">${evaluation.date}</div>
                            <button class="btn-small btn-delete" onclick="deleteEvaluation(${evaluation.id})">
                                üóëÔ∏è Eliminar
                            </button>
                        </div>
                    </div>
                    <div class="competency-summary">
                        ${competencySummary}
                    </div>
                `;
                
                container.appendChild(historyItem);
            });
        }

        function deleteEvaluation(id) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar esta evaluaci√≥n?')) {
                evaluationHistory = evaluationHistory.filter(eval => eval.id !== id);
                renderHistory();
                saveData();
            }
        }

        function clearAllHistory() {
            if (confirm('¬øEst√°s seguro de que quieres eliminar TODAS las evaluaciones? Esta acci√≥n no se puede deshacer.')) {
                evaluationHistory = [];
                renderHistory();
                saveData();
            }
        }

        // Funciones auxiliares
        function findGradeById(gradeId) {
            const allGrades = [...grades.primary, ...grades.secondary];
            return allGrades.find(grade => grade.id === gradeId);
        }

        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function saveData() {
            localStorage.setItem('grades', JSON.stringify(grades));
            localStorage.setItem('competencies', JSON.stringify(competencies));
            localStorage.setItem('evaluationHistory', JSON.stringify(evaluationHistory));
        }

        // Event listeners para cerrar modales
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.classList.remove('active');
                }
            });
        }

        // Event listener para Enter en el campo de estudiante
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.target.id === 'studentName') {
                e.preventDefault();
                addStudent();
            }
        });
    </script>
</body>
</html>